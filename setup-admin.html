<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Admin User - Otomono Jerseys</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">
    <div class="max-w-md w-full bg-gray-800 rounded-lg shadow-lg p-8">
        <h1 class="text-2xl font-bold text-center mb-8 text-cyan-400">Setup Admin User</h1>

        <!-- Admin Setup Form -->
        <form id="adminSetupForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Admin Email</label>
                <input type="email" id="admin-email" value="miicrossoft@gmail.com" class="w-full p-3 rounded bg-gray-700 border border-gray-600 text-white" readonly>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Admin Password</label>
                <input type="password" id="admin-password" class="w-full p-3 rounded bg-gray-700 border border-gray-600 text-white" placeholder="Enter password" required>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Admin Name</label>
                <input type="text" id="admin-name" value="Admin User" class="w-full p-3 rounded bg-gray-700 border border-gray-600 text-white" required>
            </div>
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded font-semibold">
                Create Admin Account
            </button>
        </form>

        <!-- Status -->
        <div id="status" class="mt-4 p-4 rounded bg-gray-700 text-center">
            <p id="statusText">Ready to create admin account</p>
        </div>

        <!-- Debug Info -->
        <div class="mt-4 p-4 rounded bg-gray-700">
            <h3 class="font-semibold mb-2">Debug Info:</h3>
            <div id="debug-info" class="text-sm space-y-1">
                <div>Loading...</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getDatabase, ref, set } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBNWEchdrKX9A2WdMa3VTnpbKgo0_eWqHE",
            authDomain: "otomono-c9938.firebaseapp.com",
            projectId: "otomono-c9938",
            storageBucket: "otomono-c9938.firebasestorage.app",
            messagingSenderId: "348906539551",
            appId: "1:348906539551:web:e249c40d0ae9e2964a632a",
            measurementId: "G-YVL497L1V3"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            const statusText = document.getElementById('statusText');
            
            statusText.textContent = message;
            
            if (type === 'success') {
                statusDiv.className = 'mt-4 p-4 rounded bg-green-700 text-center';
            } else if (type === 'error') {
                statusDiv.className = 'mt-4 p-4 rounded bg-red-700 text-center';
            } else {
                statusDiv.className = 'mt-4 p-4 rounded bg-gray-700 text-center';
            }
        }

        function updateDebugInfo() {
            const debugInfo = `
                <div>Firebase App: ${app ? 'Initialized' : 'Not initialized'}</div>
                <div>Auth: ${auth ? 'Ready' : 'Not ready'}</div>
                <div>Database: ${database ? 'Ready' : 'Not ready'}</div>
                <div>Current User: ${auth.currentUser ? auth.currentUser.email : 'None'}</div>
                <div>Timestamp: ${new Date().toISOString()}</div>
            `;
            document.getElementById('debug-info').innerHTML = debugInfo;
        }

        async function createAdminAccount(email, password, name) {
            try {
                updateStatus('Creating admin account...', 'info');
                
                // Create user account
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                console.log('Admin account created:', user.uid);
                
                // Set admin data in database
                const adminData = {
                    uid: user.uid,
                    email: email,
                    name: name,
                    role: 'admin',
                    createdAt: new Date().toISOString(),
                    lastActive: new Date().toISOString(),
                    permissions: {
                        canManageOrders: true,
                        canManageUsers: true,
                        canViewAnalytics: true,
                        canManageSettings: true
                    }
                };
                
                // Save to database
                const adminRef = ref(database, `admins/${user.uid}`);
                await set(adminRef, adminData);
                
                // Also save to users collection
                const userRef = ref(database, `users/${user.uid}`);
                await set(userRef, {
                    ...adminData,
                    userType: 'admin'
                });
                
                updateStatus('Admin account created successfully!', 'success');
                console.log('Admin data saved to database');
                
                // Auto sign in
                setTimeout(async () => {
                    try {
                        await signInWithEmailAndPassword(auth, email, password);
                        updateStatus('Signed in as admin successfully!', 'success');
                    } catch (error) {
                        console.error('Auto sign-in failed:', error);
                        updateStatus('Account created but auto sign-in failed. Please sign in manually.', 'error');
                    }
                }, 2000);
                
            } catch (error) {
                console.error('Error creating admin account:', error);
                
                if (error.code === 'auth/email-already-in-use') {
                    updateStatus('Email already in use. Trying to sign in...', 'info');
                    
                    // Try to sign in instead
                    try {
                        await signInWithEmailAndPassword(auth, email, password);
                        updateStatus('Signed in as existing admin!', 'success');
                    } catch (signInError) {
                        updateStatus('Email exists but password is incorrect.', 'error');
                    }
                } else {
                    updateStatus(`Error: ${error.message}`, 'error');
                }
            }
        }

        // Event listeners
        document.getElementById('adminSetupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const name = document.getElementById('admin-name').value;
            
            await createAdminAccount(email, password, name);
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Admin setup page loaded');
            updateDebugInfo();
            
            // Update debug info every 2 seconds
            setInterval(updateDebugInfo, 2000);
        });
    </script>
</body>

</html>