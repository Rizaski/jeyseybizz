<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Order Saving - Otomono Jerseys</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Order Manager Script -->
    <script src="js/order-manager.js"></script>
    <style>
        .rog-button {
            background: linear-gradient(135deg, #ff0040, #dc143c);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .rog-button:hover {
            background: linear-gradient(135deg, #dc143c, #b91c3c);
            transform: translateY(-2px);
        }
    </style>
</head>

<body class="min-h-screen bg-gray-900 text-white p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">Test Order Saving System</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Test Order Creation -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-bold mb-4">Create Test Order</h2>
                <form id="test-order-form" class="space-y-4">
                    <div>
                        <label class="block text-gray-300 text-sm mb-2">Customer Name *</label>
                        <input type="text" id="customer-name" required class="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg" value="Test Customer">
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm mb-2">Email *</label>
                        <input type="email" id="customer-email" required class="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg" value="test@example.com">
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm mb-2">Mobile Number *</label>
                        <input type="tel" id="mobile-number" required class="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg" value="+1234567890">
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm mb-2">Quantity *</label>
                        <input type="number" id="quantity" min="1" required class="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg" value="2">
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm mb-2">Material Preference *</label>
                        <select id="material-preference" required class="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg">
                            <option value="Waffle">Waffle</option>
                            <option value="Combweb">Combweb</option>
                            <option value="Vortex Jacquard">Vortex Jacquard</option>
                            <option value="Mesh">Mesh</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm mb-2">Status</label>
                        <select id="order-status" class="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg">
                            <option value="pending">Pending</option>
                            <option value="processing">Processing</option>
                            <option value="shipped">Shipped</option>
                            <option value="delivered">Delivered</option>
                        </select>
                    </div>
                    <button type="submit" class="rog-button w-full">
                        <i class="fas fa-save mr-2"></i> Create Test Order
                    </button>
                </form>
            </div>

            <!-- Test Results -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-bold mb-4">Test Results</h2>
                <div id="test-results" class="space-y-4">
                    <div class="text-gray-400">No tests run yet...</div>
                </div>

                <div class="mt-6 space-y-2">
                    <button onclick="testFirebaseConnection()" class="rog-button w-full">
                        <i class="fas fa-wifi mr-2"></i> Test Firebase Connection
                    </button>
                    <button onclick="testOrderRetrieval()" class="rog-button w-full">
                        <i class="fas fa-search mr-2"></i> Test Order Retrieval
                    </button>
                    <button onclick="syncPendingOrders()" class="rog-button w-full">
                        <i class="fas fa-sync mr-2"></i> Sync Pending Orders
                    </button>
                </div>
            </div>
        </div>

        <!-- Order List -->
        <div class="mt-8 bg-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Recent Orders</h2>
            <div id="orders-list" class="space-y-2">
                <div class="text-gray-400">Loading orders...</div>
            </div>
        </div>
    </div>

    <script>
        // Test order form submission
        document.getElementById('test-order-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const orderData = {
                customerName: document.getElementById('customer-name').value,
                customerEmail: document.getElementById('customer-email').value,
                mobileNumber: document.getElementById('mobile-number').value,
                quantity: parseInt(document.getElementById('quantity').value),
                materialPreference: document.getElementById('material-preference').value,
                status: document.getElementById('order-status').value
            };

            try {
                addTestResult('Creating test order...', 'info');
                const result = await orderManager.saveOrder(orderData);
                addTestResult(`✅ Order created successfully!<br>ID: ${result.id}<br>Saved to: ${result.savedTo}`, 'success');
                loadOrders();
            } catch (error) {
                addTestResult(`❌ Order creation failed: ${error.message}`, 'error');
            }
        });

        // Test Firebase connection
        async function testFirebaseConnection() {
            try {
                addTestResult('Testing Firebase connection...', 'info');
                await orderManager.syncPendingOrders();
                addTestResult('✅ Firebase connection successful!', 'success');
            } catch (error) {
                addTestResult(`❌ Firebase connection failed: ${error.message}`, 'error');
            }
        }

        // Test order retrieval
        async function testOrderRetrieval() {
            try {
                addTestResult('Testing order retrieval...', 'info');
                const orders = await orderManager.getAllOrders();
                addTestResult(`✅ Retrieved ${orders.length} orders successfully!`, 'success');
                loadOrders();
            } catch (error) {
                addTestResult(`❌ Order retrieval failed: ${error.message}`, 'error');
            }
        }

        // Sync pending orders
        async function syncPendingOrders() {
            try {
                addTestResult('Syncing pending orders...', 'info');
                await orderManager.syncPendingOrders();
                addTestResult('✅ Pending orders synced successfully!', 'success');
                loadOrders();
            } catch (error) {
                addTestResult(`❌ Sync failed: ${error.message}`, 'error');
            }
        }

        // Add test result
        function addTestResult(message, type) {
            const resultsDiv = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'success' ? 'text-green-400' : type === 'error' ? 'text-red-400' : 'text-yellow-400';

            const resultDiv = document.createElement('div');
            resultDiv.className = `text-sm ${colorClass}`;
            resultDiv.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> ${message}`;

            resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild);

            // Keep only last 10 results
            while (resultsDiv.children.length > 10) {
                resultsDiv.removeChild(resultsDiv.lastChild);
            }
        }

        // Load orders
        async function loadOrders() {
            try {
                const orders = await orderManager.getAllOrders();
                const ordersList = document.getElementById('orders-list');

                if (orders.length === 0) {
                    ordersList.innerHTML = '<div class="text-gray-400">No orders found</div>';
                    return;
                }

                ordersList.innerHTML = orders.slice(0, 5).map(order => `
                    <div class="bg-gray-700 rounded-lg p-4">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-semibold">${order.customerName}</div>
                                <div class="text-sm text-gray-400">${order.customerEmail}</div>
                                <div class="text-sm text-gray-400">Qty: ${order.quantity} | ${order.materialPreference}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-gray-400">${order.status}</div>
                                <div class="text-xs text-gray-500">${new Date(order.createdAt).toLocaleDateString()}</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('orders-list').innerHTML = `<div class="text-red-400">Error loading orders: ${error.message}</div>`;
            }
        }

        // Load orders on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadOrders();
        });
    </script>
</body>

</html>