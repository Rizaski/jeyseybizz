<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Diagnostic - Otomono Jerseys</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">
    <div class="max-w-2xl w-full bg-gray-800 rounded-lg shadow-lg p-8">
        <h1 class="text-2xl font-bold text-center mb-8 text-cyan-400">Firebase Diagnostic</h1>

        <div id="diagnostic-results" class="space-y-4">
            <div class="p-4 rounded bg-gray-700">
                <h3 class="font-semibold mb-2">Firebase Configuration</h3>
                <div id="config-status">Checking...</div>
            </div>

            <div class="p-4 rounded bg-gray-700">
                <h3 class="font-semibold mb-2">Authentication Status</h3>
                <div id="auth-status">Checking...</div>
            </div>

            <div class="p-4 rounded bg-gray-700">
                <h3 class="font-semibold mb-2">Network Status</h3>
                <div id="network-status">Checking...</div>
            </div>

            <div class="p-4 rounded bg-gray-700">
                <h3 class="font-semibold mb-2">Console Logs</h3>
                <div id="console-logs" class="text-sm font-mono bg-black p-2 rounded max-h-40 overflow-y-auto">
                    <div>Loading diagnostic...</div>
                </div>
            </div>
        </div>

        <div class="mt-6 text-center">
            <button onclick="runDiagnostic()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">
                Run Diagnostic Again
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBNWEchdrKX9A2WdMa3VTnpbKgo0_eWqHE",
            authDomain: "otomono-c9938.firebaseapp.com",
            projectId: "otomono-c9938",
            storageBucket: "otomono-c9938.firebasestorage.app",
            messagingSenderId: "348906539551",
            appId: "1:348906539551:web:e249c40d0ae9e2964a632a",
            measurementId: "G-YVL497L1V3"
        };

        function log(message) {
            const consoleDiv = document.getElementById('console-logs');
            const timestamp = new Date().toLocaleTimeString();
            consoleDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        async function runDiagnostic() {
            log('Starting Firebase diagnostic...');
            
            // Clear previous results
            document.getElementById('config-status').innerHTML = 'Checking...';
            document.getElementById('auth-status').innerHTML = 'Checking...';
            document.getElementById('network-status').innerHTML = 'Checking...';
            document.getElementById('console-logs').innerHTML = '<div>Running diagnostic...</div>';

            try {
                // Test Firebase initialization
                log('Initializing Firebase...');
                const app = initializeApp(firebaseConfig);
                log('Firebase initialized successfully');
                
                document.getElementById('config-status').innerHTML = `
                    <div class="text-green-400">✅ Firebase initialized</div>
                    <div class="text-sm text-gray-400 mt-1">Project: ${firebaseConfig.projectId}</div>
                    <div class="text-sm text-gray-400">Auth Domain: ${firebaseConfig.authDomain}</div>
                `;

                // Test Authentication
                log('Testing Firebase Auth...');
                const auth = getAuth(app);
                log('Firebase Auth initialized');
                
                document.getElementById('auth-status').innerHTML = `
                    <div class="text-green-400">✅ Firebase Auth initialized</div>
                    <div class="text-sm text-gray-400 mt-1">Current user: ${auth.currentUser ? auth.currentUser.email : 'None'}</div>
                `;

                // Test network connectivity
                log('Testing network connectivity...');
                try {
                    const response = await fetch('https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=' + firebaseConfig.apiKey, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            email: 'test@example.com',
                            password: 'testpassword',
                            returnSecureToken: true
                        })
                    });
                    
                    if (response.ok) {
                        log('Network connectivity: OK');
                        document.getElementById('network-status').innerHTML = `
                            <div class="text-green-400">✅ Network connectivity OK</div>
                            <div class="text-sm text-gray-400 mt-1">Firebase API accessible</div>
                        `;
                    } else {
                        const error = await response.json();
                        log(`Network test failed: ${error.error?.message || 'Unknown error'}`);
                        document.getElementById('network-status').innerHTML = `
                            <div class="text-yellow-400">⚠️ Network test failed</div>
                            <div class="text-sm text-gray-400 mt-1">${error.error?.message || 'Unknown error'}</div>
                        `;
                    }
                } catch (networkError) {
                    log(`Network error: ${networkError.message}`);
                    document.getElementById('network-status').innerHTML = `
                        <div class="text-red-400">❌ Network error</div>
                        <div class="text-sm text-gray-400 mt-1">${networkError.message}</div>
                    `;
                }

                // Test authentication methods
                log('Testing authentication methods...');
                try {
                    // Try to create a test user (this will fail but shows if auth is working)
                    await createUserWithEmailAndPassword(auth, 'test@example.com', 'testpassword');
                } catch (authError) {
                    if (authError.code === 'auth/email-already-in-use') {
                        log('Auth test: Email already in use (expected)');
                    } else if (authError.code === 'auth/weak-password') {
                        log('Auth test: Weak password (expected)');
                    } else {
                        log(`Auth test error: ${authError.code} - ${authError.message}`);
                    }
                }

                log('Diagnostic completed successfully');

            } catch (error) {
                log(`Diagnostic failed: ${error.message}`);
                document.getElementById('config-status').innerHTML = `
                    <div class="text-red-400">❌ Firebase initialization failed</div>
                    <div class="text-sm text-gray-400 mt-1">${error.message}</div>
                `;
            }
        }

        // Run diagnostic on page load
        runDiagnostic();
    </script>
</body>

</html>