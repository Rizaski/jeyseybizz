<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Test - Otomono</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase Configuration Files -->
    <script src="firebase-env-config.js"></script>
    <script src="firebase-simple-config.js"></script>
    <script src="firebase-robust-config.js"></script>

    <!-- Global Firebase Authentication -->
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-auth-wrapper.js"></script>
</head>

<body class="bg-gray-900 text-white min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">Authentication Test</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Authentication Status -->
            <div class="bg-gray-800 p-6 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">Authentication Status</h2>
                <div id="auth-status" class="space-y-2">
                    <p>Loading...</p>
                </div>
            </div>

            <!-- User Information -->
            <div class="bg-gray-800 p-6 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">User Information</h2>
                <div id="user-info" class="space-y-2">
                    <p>No user data</p>
                </div>
            </div>

            <!-- Firebase Status -->
            <div class="bg-gray-800 p-6 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">Firebase Status</h2>
                <div id="firebase-status" class="space-y-2">
                    <p>Loading...</p>
                </div>
            </div>

            <!-- Actions -->
            <div class="bg-gray-800 p-6 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">Actions</h2>
                <div class="space-y-4">
                    <button id="test-auth" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                        Test Authentication
                    </button>
                    <button id="test-google" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
                        Test Google Sign-In
                    </button>
                    <button id="test-signout" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
                        Sign Out
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test authentication functionality
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Auth Test: Starting authentication test...');

            // Wait for Firebase to initialize
            await new Promise(resolve => setTimeout(resolve, 2000));

            updateStatus();

            // Set up event listeners
            document.getElementById('test-auth').addEventListener('click', testAuthentication);
            document.getElementById('test-google').addEventListener('click', testGoogleSignIn);
            document.getElementById('test-signout').addEventListener('click', testSignOut);

            // Listen for auth state changes
            if (window.FirebaseAuth) {
                window.FirebaseAuth.onAuthStateChanged((user) => {
                    console.log('Auth Test: Auth state changed:', user);
                    updateStatus();
                });
            }
        });

        async function updateStatus() {
            const authStatus = document.getElementById('auth-status');
            const userInfo = document.getElementById('user-info');
            const firebaseStatus = document.getElementById('firebase-status');

            // Check Firebase status
            if (window.firebase) {
                firebaseStatus.innerHTML = `
                    <p><strong>Firebase:</strong> ✅ Available</p>
                    <p><strong>Auth:</strong> ${window.firebase.auth ? '✅ Available' : '❌ Not Available'}</p>
                    <p><strong>Config:</strong> ${window.firebase.config ? '✅ Available' : '❌ Not Available'}</p>
                `;
            } else {
                firebaseStatus.innerHTML = '<p><strong>Firebase:</strong> ❌ Not Available</p>';
            }

            // Check FirebaseAuth wrapper
            if (window.FirebaseAuth) {
                try {
                    const user = await window.FirebaseAuth.getCurrentUser();
                    if (user) {
                        authStatus.innerHTML = `
                            <p><strong>Status:</strong> ✅ Authenticated</p>
                            <p><strong>User ID:</strong> ${user.uid}</p>
                            <p><strong>Email:</strong> ${user.email}</p>
                        `;

                        userInfo.innerHTML = `
                            <p><strong>Name:</strong> ${user.displayName || 'Not set'}</p>
                            <p><strong>Email:</strong> ${user.email}</p>
                            <p><strong>Photo URL:</strong> ${user.photoURL || 'Not set'}</p>
                            <p><strong>Email Verified:</strong> ${user.emailVerified ? 'Yes' : 'No'}</p>
                        `;
                    } else {
                        authStatus.innerHTML = '<p><strong>Status:</strong> ❌ Not Authenticated</p>';
                        userInfo.innerHTML = '<p>No user data</p>';
                    }
                } catch (error) {
                    authStatus.innerHTML = `<p><strong>Error:</strong> ${error.message}</p>`;
                    userInfo.innerHTML = '<p>Error getting user data</p>';
                }
            } else {
                authStatus.innerHTML = '<p><strong>FirebaseAuth:</strong> ❌ Not Available</p>';
                userInfo.innerHTML = '<p>FirebaseAuth wrapper not available</p>';
            }
        }

        async function testAuthentication() {
            console.log('Auth Test: Testing authentication...');
            try {
                if (window.FirebaseAuth) {
                    const user = await window.FirebaseAuth.getCurrentUser();
                    console.log('Auth Test: Current user:', user);
                    updateStatus();
                } else {
                    console.error('Auth Test: FirebaseAuth not available');
                }
            } catch (error) {
                console.error('Auth Test: Authentication test failed:', error);
            }
        }

        async function testGoogleSignIn() {
            console.log('Auth Test: Testing Google sign-in...');
            try {
                if (window.FirebaseAuth) {
                    const user = await window.FirebaseAuth.signInWithGoogle();
                    console.log('Auth Test: Google sign-in successful:', user);
                    updateStatus();
                } else {
                    console.error('Auth Test: FirebaseAuth not available');
                }
            } catch (error) {
                console.error('Auth Test: Google sign-in failed:', error);
            }
        }

        async function testSignOut() {
            console.log('Auth Test: Testing sign-out...');
            try {
                if (window.FirebaseAuth) {
                    await window.FirebaseAuth.signOut();
                    console.log('Auth Test: Sign-out successful');
                    updateStatus();
                } else {
                    console.error('Auth Test: FirebaseAuth not available');
                }
            } catch (error) {
                console.error('Auth Test: Sign-out failed:', error);
            }
        }
    </script>
</body>

</html>