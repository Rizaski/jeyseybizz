<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Debug - Otomono</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="firebase-robust-config.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">Firebase Debug Console</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Connection Status -->
            <div class="bg-gray-800 p-6 rounded-lg">
                <h2 class="text-xl font-semibold mb-4 text-green-400">Connection Status</h2>
                <div id="connection-status" class="text-lg">
                    <div class="animate-pulse">Testing Firebase connection...</div>
                </div>
            </div>
            
            <!-- Configuration -->
            <div class="bg-gray-800 p-6 rounded-lg">
                <h2 class="text-xl font-semibold mb-4 text-blue-400">Configuration</h2>
                <div id="config-display" class="text-sm">
                    <div class="animate-pulse">Loading configuration...</div>
                </div>
            </div>
        </div>
        
        <!-- Test Buttons -->
        <div class="bg-gray-800 p-6 rounded-lg mb-8">
            <h2 class="text-xl font-semibold mb-4 text-purple-400">Test Actions</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="testFirebaseConnection()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                    Test Connection
                </button>
                <button onclick="retryFirebase()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors">
                    Retry Firebase
                </button>
                <button onclick="debugStatus()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors">
                    Debug Status
                </button>
            </div>
        </div>
        
        <!-- Console Output -->
        <div class="bg-gray-800 p-6 rounded-lg">
            <h2 class="text-xl font-semibold mb-4 text-yellow-400">Console Output</h2>
            <div id="console-output" class="bg-gray-900 p-4 rounded text-sm font-mono overflow-auto max-h-64">
                <div>Firebase Debug Console Ready...</div>
            </div>
        </div>
    </div>

    <script>
        // Override console.log to display in the page
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToConsole(message, type = 'log') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-red-400' : type === 'warn' ? 'text-yellow-400' : 'text-green-400';
            output.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole(args.join(' '), 'warn');
        };
        
        async function testFirebaseConnection() {
            const statusDiv = document.getElementById('connection-status');
            const configDiv = document.getElementById('config-display');
            
            try {
                console.log('Starting Firebase connection test...');
                
                // Test if Firebase is available
                if (typeof window.initializeFirebaseRobust === 'function') {
                    console.log('Firebase robust config loaded');
                    
                    const result = await window.initializeFirebaseRobust();
                    
                    if (result && window.firebase && window.firebase.isReady) {
                        statusDiv.innerHTML = '<div class="text-green-400 text-lg">✅ Firebase Connected Successfully!</div>';
                        console.log('Firebase connection successful');
                        
                        // Display configuration
                        configDiv.innerHTML = `
                            <div class="space-y-2">
                                <div><strong>Project ID:</strong> ${window.firebase.config?.projectId}</div>
                                <div><strong>Auth Domain:</strong> ${window.firebase.config?.authDomain}</div>
                                <div><strong>API Key:</strong> ${window.firebase.config?.apiKey?.substring(0, 20)}...</div>
                                <div><strong>App ID:</strong> ${window.firebase.config?.appId}</div>
                            </div>
                        `;
                    } else {
                        statusDiv.innerHTML = '<div class="text-red-400 text-lg">❌ Firebase Connection Failed</div>';
                        console.error('Firebase connection failed');
                        
                        if (window.firebase && window.firebase.lastError) {
                            console.error('Last error:', window.firebase.lastError);
                        }
                    }
                } else {
                    statusDiv.innerHTML = '<div class="text-red-400 text-lg">❌ Firebase Config Not Loaded</div>';
                    console.error('Firebase robust configuration not available');
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="text-red-400 text-lg">❌ Test Failed</div>';
                console.error('Firebase test error:', error);
            }
        }
        
        async function retryFirebase() {
            console.log('Retrying Firebase initialization...');
            if (typeof window.retryFirebaseInitialization === 'function') {
                const result = await window.retryFirebaseInitialization();
                console.log('Retry result:', result);
            } else {
                console.error('Retry function not available');
            }
        }
        
        function debugStatus() {
            console.log('Running Firebase debug...');
            if (typeof window.debugFirebaseStatus === 'function') {
                window.debugFirebaseStatus();
            } else {
                console.error('Debug function not available');
            }
        }
        
        // Auto-test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Firebase Debug Console loaded');
            setTimeout(testFirebaseConnection, 1000);
        });
    </script>
</body>
</html>
